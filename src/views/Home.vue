<template>
  <div class="home">
    <p>количество звуковысот <input type="number" v-model="count"></p>
    <!-- <button @click="handleDownload">download</button>
    <button @click="handleRandom">random</button> -->
    <button @click="nextTrack">next</button>
    <button @click="handlePlay">play</button>
    <button @click="handleStop">stop</button>
  </div>
</template>

<script>
// @ is an alias to /src
import Beat from "@/modules/beat";
import Track from "@/modules/track";
import Duration from "@/modules/helpers/duration";
import * as WebAudioFontPlayer from "webaudiofont";
import * as MidiPlayer from "midi-player-js";
import HelpMath from '../modules/helpMath';

let instr = null;
const AudioContextFunc = window.AudioContext || window.webkitAudioContext;
const audioContext = new AudioContextFunc();
const player = new WebAudioFontPlayer();

let played = false
let P = '';
const pipe = { key: 0 };
      function stopPipe(pipe) {
        if (pipe.envelope) {
          pipe.envelope.cancel();
          pipe.envelope = null;
        }
      }
      function playPipe(pipe) {
        stopPipe(pipe);
        pipe.envelope = player.queueWaveTable(
          audioContext,
          audioContext.destination,
          instr,
          0,
          pipe.key,
          999,
          true
        );
      }


export default {
  name: "Home",
  data() {
    return {
      track: null,
      count: 3,
      played: false,
      tracks: [
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAAEugD/WAQEAhgIAP9RAwehIAD/AwRMZWFkALMKQACzB2QA4wBAALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRAJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZGCDSQAAk0tkJINLAAyTS2Qkg0sADJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sADJNLZCSDSwAkk0tkDINLAAyTS2QMg0sADJNLZAyDSwAMk0lkJINJAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTRmQkg0YADJNIZCSDSAAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWRgg0kAAJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sADJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sAJJNLZAyDSwAMk0tkDINLAAyTS2QMg0sADJNJZCSDSQAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0ZkJINGAAyTSGQkg0gADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0hkJINIAAyTSGQkg0gADJNIZCSDSABsk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWRgg0kAAJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sADJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sAJJNLZAyDSwAMk0tkDINLAAyTS2QMg0sADJNJZCSDSQAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0ZkJINGAAyTSGQkg0gADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNJZCSDSQAMk0lkYINJAACTS2Qkg0sADJNLZCSDSwAMk0tkJINLAAyTS2Qkg0sADJNLZCSDSwAMk0tkJINLACSTS2QMg0sADJNLZAyDSwAMk0tkDINLAAyTSWQkg0kADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gADJNGZCSDRgAMk0hkJINIAAyTSWQkg0kADJNJZCSDSQAMk0lkJINJAAyTSWQkg0kADJNIZCSDSAAMk0hkJINIAAyTSGQkg0gAgwyzZQAAs2QAALMGDACzCkAAswdkAOMAQADDUQGzZQAAs2QAALMGDACzCkAAswdkAOMAQADDUQCzZQAAs2QAALMGDACzCkAAswdkAOMAQADDURL/LwA=',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAADKwD/WAQEAhgIAP9RAwehIAD/AwRMZWFkALMKQACzB2QA4wBAALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRgwCTUWQYg1EAeJNRZBiDUQAYk09kGINPAEiTT2QYg08ASJNOZBiDTgAYk0xkGINMAEiTTGQYg0wAGJNMZBiDTABIk0xbGINMABiTTFIYg0wASJNMQBiDTAAYk0w3GINMAEiTTCUYg0wASJNMZBiDTAAYk0pkGINKABiTTGQYg0wAeJNMZBiDTAB4k0xkGINMABiTT2QYg08AGJNRZBiDUQB4k1FkGINRABiTT2QYg08ASJNPZBiDTwBIk05kGINOABiTTGQYg0wASJNMZBiDTAAYk0xkGINMAEiTTFsYg0wAGJNMUhiDTABIk0xAGINMABiTTDcYg0wASJNMJRiDTABIk0xkGINMABiTSmQYg0oAGJNMZBiDTAB4k0xkGINMAHiTTGQYg0wAGJNPZBiDTwAYk1FkGINRAHiTUWQYg1EAGJNPZBiDTwBIk09kGINPAEiTTmQYg04AGJNMZBiDTABIk0xkGINMABiTTGQYg0wASJNMWxiDTAAYk0xSGINMAEiTTEAYg0wAGJNMNxiDTABIk0wlGINMAEiTTGQYg0wAGJNKZBiDSgAYk0xkGINMAHiTTGQYg0wAeJNMZBiDTAAYk09kGINPABiTUWQYg1EAeJNRZBiDUQAYk09kGINPAEiTT2QYg08ASJNOZBiDTgAYk0xkGINMAEiTTGQYg0wAGJNMZBiDTABIk0xbGINMABiTTFIYg0wASJNMQBiDTAAYk0w3GINMAEiTTCUYg0wASJNMZBiDTAAYk0pkGINKABiTTGQYg0wAeJNMZBiDTAB4k0xkGINMABiTT2QYg08AgxizZQAAs2QAALMGDACzCkAAswdkAOMAQADDUQGzZQAAs2QAALMGDACzCkAAswdkAOMAQADDUQCzZQAAs2QAALMGDACzCkAAswdkAOMAQADDURL/LwA=',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAADigD/WAQEAhgIAP9RAwcnDgD/AwRMZWFkALMKQACzB2QA4wBAALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRAJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTWQwg00AGJNNZDCDTQAYk01kMINNAACTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNNZDCDTQAAk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNSZDCDUgAYk1JkMINSABiTUmQwg1IAAJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTTWQwg00AGJNNZDCDTQAYk01kMINNAACTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk01kMINNABiTTWQwg00AGJNNZDCDTQAAk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTTWQwg00AAJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTUmQwg1IAGJNSZDCDUgAYk1JkMINSAACTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk01kMINNABiTTWQwg00AGJNNZDCDTQCDALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRAbNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNREv8vAA==',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAADigD/WAQEAhgIAP9RAwcnDgD/AwRMZWFkALMKQACzB2QA4wBAALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRAJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTWQwg00AGJNNZDCDTQAYk01kMINNAACTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNNZDCDTQAAk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNSZDCDUgAYk1JkMINSABiTUmQwg1IAAJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTTWQwg00AGJNNZDCDTQAYk01kMINNAACTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk0xkMINMABiTTGQwg0wAGJNMZDCDTAAYk01kMINNABiTTWQwg00AGJNNZDCDTQAAk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTTWQwg00AAJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTT2Qwg08AGJNPZDCDTwAYk09kMINPABiTUmQwg1IAGJNSZDCDUgAYk1JkMINSAACTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk1FkMINRABiTUWQwg1EAGJNRZDCDUQAYk01kMINNABiTTWQwg00AGJNNZDCDTQCDALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRAbNlAACzZAAAswYMALMKQACzB2QA4wBAAMNRALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNREv8vAA==',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAABNQD/WAQEAhgIAP9RAwWMdAD/AwRMZWFkALMKQACzB2QA4wBAALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJAJNMZDCDTACJYJNMZDCDTAAwk01kMINNADCTTGQwg0wAAJNMZDCDTACJYJNMZDCDTAAwk01kMINNADCTVGQwg1QAAJNMZDCDTACJYJNMZDCDTAAwk01kMINNADCTTGQwg0wAAJNMZDCDTACOULNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJAbNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJALNlAACzZAAAswYMALMKQACzB2QA4wBAAMNJEv8vAA==',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAAAvgD/WAQEAhgIAP9RAwbvkQD/AwpjcHJhdG8uY29tALAKQACwB2QA4ABAALBlAACwZAAAsAYMALAKQACwB2QA4ABAALBlAACwZAAAsAYMALAKQACwB2QA4ABAALBlAACwZAAAsAYMALAKQACwB2QA4ABA7wCwZQAAsGQAALAGDACwCkAAsAdkAOAAQAGwZQAAsGQAALAGDACwCkAAsAdkAOAAQACwZQAAsGQAALAGDACwCkAAsAdkAOAAQBL/LwA=',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAAFKgD/WAQEAhgIAP9RAwmJaAD/AwRMZWFkALcKQAC3B2QA5wBAALdlAAC3ZAAAtwYMALcKQAC3B2QA5wBAAMdRALdlAAC3ZAAAtwYMALcKQAC3B2QA5wBAAMdRALdlAAC3ZAAAtwYMALcKQAC3B2QA5wBAAMdRAJdDZDCHQwAYlz5kMIc+ABiXQWQwh0EAAJdKZBiHSgAIl0hkEIdIAACXSmQYh0oACJdIZBCHSAAAl0pkGIdKABiXRmQgh0YAEJdDZDCHQwAYlz9kMIc/ABiXQWQwh0EAAJdLZBiHSwAIl0pkEIdKAACXS2QYh0sACJdKZBCHSgAAl0hkIIdIABCXRmQgh0YAEJdBZDCHQQAYlz5kMIc+ABiXQWQwh0EAAJdKZBiHSgAIl0hkEIdIAACXSmQYh0oACJdIZBCHSAAAl0pkKIdKAAiXRmQoh0YACJdBZDCHQQAYlz5kMIc+ABiXQWQwh0EAIJdGZBCHRgAAl0hkIIdIAACXRmQQh0YAAJdIZCiHSAAIl0FkKIdBAAiXRmQwh0YAGJdFZDCHRQAYlz5kMIc+AACXSmQgh0oAAJdIZBCHSAAAl0pkIIdKAACXSGQQh0gAAJdFZCiHRQAIl0ZkKIdGAAiXS2Qoh0sAIJdKZCiHSgAgl0ZkKIdGAAiXS2Qgh0sAAJdKZBCHSgAAl0tkIIdLAACXSmQQh0oAAJdIZCiHSAAIl0pkKIdKAAiXQWQwh0EAGJdGZDCHRgAYl0ZkMIdGAACXSmQgh0oAAJdIZBCHSAAAl0pkIIdKAACXSGQQh0gAAJdIZCiHSAAIl0FkKIdBAAiXRWQwh0UAGJdGZDCHRgAYl0hkMIdIACCXRmQQh0YAAJdIZCCHSAAAl0ZkEIdGAACXRWQoh0UACJdBZCiHQQAIl0NkMIdDABiXPmQwhz4AGJdBZDCHQQAAl0pkGIdKAAiXSGQQh0gAAJdKZBiHSgAIl0hkEIdIAACXSmQYh0oAGJdGZCCHRgAQl0NkMIdDABiXP2Qwhz8AGJdBZDCHQQAAl0tkGIdLAAiXSmQQh0oAAJdLZBiHSwAIl0pkEIdKAACXSGQgh0gAEJdGZCCHRgAQl0FkMIdBABiXPmQwhz4AGJdBZDCHQQAAl0pkGIdKAAiXSGQQh0gAAJdKZBiHSgAIl0hkEIdIAACXSmQoh0oACJdGZCiHRgAIl0FkMIdBABiXPmQwhz4AGJdBZDCHQQAgl0ZkEIdGAACXSGQgh0gAAJdGZBCHRgAAl0hkKIdIAAiXQWQoh0EACJdGZDCHRgAYl0VkMIdFABiXPmQwhz4AAJdKZCCHSgAAl0hkEIdIAACXSmQgh0oAAJdIZBCHSAAAl0VkKIdFAAiXRmQoh0YACJdLZCiHSwAgl0pkKIdKACCXRmQoh0YACJdLZCCHSwAAl0pkEIdKAACXS2Qgh0sAAJdKZBCHSgAAl0hkKIdIAAiXSmQoh0oACJdBZDCHQQAYl0ZkMIdGABiXRmQwh0YAAJdKZCCHSgAAl0hkEIdIAACXSmQgh0oAAJdIZBCHSAAAl0hkKIdIAAiXQWQoh0EACJdFZDCHRQAYl0ZkMIdGABiXSGQwh0gAIJdGZBCHRgAAl0hkIIdIAACXRmQQh0YAAJdFZCiHRQAIl0FkKIdBAIMIt2UAALdkAAC3BgwAtwpAALcHZADnAEAAx1EBt2UAALdkAAC3BgwAtwpAALcHZADnAEAAx1EAt2UAALdkAAC3BgwAtwpAALcHZADnAEAAx1ES/y8A',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAAFUQD/WAQEAhgIAP9RAwpJbQD/AwRMZWFkALYKQAC2B2QA5gBAALZlAAC2ZAAAtgYMALYKQAC2B2QA5gBAAMZRALZlAAC2ZAAAtgYMALYKQAC2B2QA5gBAAMZRALYKQAC2B2QA5gBAAMZRALZlAAC2ZAAAtgYMALYKQAC2B2QA5gBAAMZRALYKQAC2B2QA5gBAAMZRpACWQmQohkIACJZCZCiGQgAIlkJkKIZCAAiWQmQohkIACJZCZCiGQgAIlkJkKIZCAAiWQmQghkIAAJZGZA+GRgABlkZkF4ZGAAmWRmQPhkYAAZZLZCiGSwAIlktkKIZLAAiWS2QohksACJZLZCiGSwAIlktkKIZLAAiWS2QohksACJZJZCiGSQAIlklkKIZJAAiWRmQohkYACJZGZCiGRgAIlkZkKIZGAAiWRmQohkYACJZGZCiGRgAIlkZkKIZGAAiWRmQYhkYACJZGZBCGRgAAlkZkGIZGAAiWRmQQhkYAAJZBZCiGQQAIlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkFkKIZBAAiWQmQohkIACJZCZCiGQgAIlkJkKIZCAAiWQmQohkIACJZCZCiGQgAIlkJkKIZCAAiWQmQfhkIAAZZGZA+GRgABlkZkF4ZGAAmWRmQPhkYAAZZLZCiGSwAIlktkKIZLAAiWS2QohksACJZLZCiGSwAIlktkKIZLAAiWS2QohksACJZJZCiGSQAIlklkKIZJAAiWRmQohkYACJZGZCiGRgAIlkZkKIZGAAiWRmQohkYACJZGZCiGRgAIlkZkKIZGAAiWRmQYhkYACJZGZBCGRgAAlkZkGIZGAAiWRmQQhkYAAJZBZCiGQQAIlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkFkKIZBAAiWQmQohkIACJZCZCiGQgAIlkJkKIZCAAiWQmQohkIACJZGZCiGRgAIlkZkIIZGAACWTmQohk4ACJZOZBCGTgAAlk1kGIZNAAiWTWQQhk0AAJZLZCiGSwAIlktkKIZLAAiWS2QohksACJZJZCiGSQAIlklkKIZJAAiWSWQohkkACJZEZCiGRAAIlkRkKIZEAAiWRmQohkYACJZGZCiGRgAIlkZkKIZGAAiWRmQohkYACJZJZCiGSQAIlkdkKIZHAAiWRmQghkYAAJZEZBCGRAAAlkJkGIZCAAiWQWQQhkEAAJZBZCiGQQAIlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkRkYIZEAACWQWRghkEAAJZCZCiGQgAIlkJkKIZCAAiWQmQohkIACJZCZCiGQgAIlkZkKIZGAAiWRmQghkYAAJZOZCiGTgAIlk5kEIZOAACWTWQYhk0ACJZNZBCGTQAAlktkKIZLAAiWS2QohksACJZLZCiGSwAIlklkKIZJAAiWSWQohkkACJZJZCiGSQAIlkRkKIZEAAiWRGQohkQACJZGZCiGRgAIlkZkKIZGAAiWRmQohkYACJZGZCiGRgAIlklkKIZJAAiWR2QohkcACJZGZCCGRgAAlkRkEIZEAACWQmQYhkIACJZBZBCGQQAAlkFkKIZBAAiWQWQohkEACJZBZCiGQQAIlkFkKIZBAAiWQmRghkIAAJZEZDCGRAAAlkJkMIZCAIMAtmUAALZkAAC2BgwAtgpAALYHZADmAEAAxlEBtmUAALZkAAC2BgwAtgpAALYHZADmAEAAxlEAtmUAALZkAAC2BgwAtgpAALYHZADmAEAAxlES/y8A',
        'data:audio/mid;base64,TVRoZAAAAAYAAQABAGBNVHJrAAACFgD/WAQEAhgIAP9RAwdxfAD/AwVWb2ljZQC4CkAAuAdkAOgAQAC4ZQAAuGQAALgGDAC4CkAAuAdkAOgAQADIUQC4ZQAAuGQAALgGDAC4CkAAuAdkAOgAQADIUQC4ZQAAuGQAALgGDAC4CkAAuAdkAOgAQADIUQCYQGQwiEAAYJhAZDCIQAAwmD1kMIg9AACYPmQwiD4AgwCYOWQwiDkAAJhDZIEQiEMAAJhCZGCIQgAAmD5kMIg+AACYQGQwiEAAglCYQGQwiEAAAJg+ZDCIPgAAmEBkMIhAAGCYQGQwiEAAMJhCZDCIQgAAmD5kMIg+AIMAmDlkMIg5AACYQ2SBEIhDAACYRWRgiEUAAJg+ZDCIPgAAmEBkMIhAAIMwmEBkMIhAAGCYQGQwiEAAMJg9ZDCIPQAAmD5kMIg+AIMAmDlkMIg5AACYQ2SBEIhDAACYQmRgiEIAAJg+ZDCIPgAAmEBkMIhAAIJQmEBkMIhAAACYPmQwiD4AAJhAZDCIQABgmEBkMIhAADCYQmQwiEIAAJg+ZDCIPgCDAJg5ZDCIOQAAmENkgRCIQwAAmEVkYIhFAACYPmQwiD4AAJhAZDCIQACGMLhlAAC4ZAAAuAYMALgKQAC4B2QA6ABAAMhRALhlAAC4ZAAAuAYMALgKQAC4B2QA6ABAAMhRALhlAAC4ZAAAuAYMALgKQAC4B2QA6ABAAMhRE/8vAA=='
      ]
    };
  },
  methods: {
    handleDownload() {
      const link = document.createElement("a");
      link.download = "name.mid";
      link.href = this.track.getMidi();
      link.click();
    },
    handleRandom() {
      const b = new Beat(
        [Duration.Eighth, Duration.Quarter],
        10
      );
      const t = new Track(b, 10);
      this.track = t;
      // t.getMidi();
    },
    async nextTrack(){
      this.handleStop()
      console.log(HelpMath.arrayRandElement(this.tracks))
      this.track = HelpMath.arrayRandElement(this.tracks);
    },
    async handlePlay() {
      this.handleStop()
      played = true;

      let count = this.count
      const Player = new MidiPlayer.Player(function(event) {
        if (event.name === "Note on") {
          // pipe.key = event.noteNumber;
          function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = min + Math.random() * (max + 1 - min);
            return Math.floor(rand);
          }

          let ar = ['60','62','64','65','67','69','71','72','74','76','77','79','81','83']
          pipe.key = parseInt(ar[randomInteger(0,count-1)])
          playPipe(pipe);
        }
        if (event.name === "Note off") {
          pipe.key = event.noteNumber;
          stopPipe(pipe);
          if(!played){
            Player.stop()
          }
        }
        if (event.name === "End of Track") {
          pipe.key = event.noteNumber;
          stopPipe(pipe);
        }
        console.log(event);
      });

      Player.on("endOfFile", function() {
        stopPipe(pipe);
      });
      

      P = Player;
      Player.loadDataUri(this.track);
      Player.play();

      // let played = this.played;
      // Player.on("playing", function() {
      //   if(!played){
      //    Player = Player.stop()
      //   }
      // });
    },
    handleStop(){
      played = false;
      // P.on("note off", function() {
      //   stopPipe(pipe);
      // });
      // Player.triggerPlayerEvent('End of Track', {noteNumber: 0})
      // Player.triggerPlayerEvent('Note off', {noteNumber: 0})

      // stopPipe(pipe);
      // P = ''
      // Player.stopPipe();
    }
  },
  mounted() {
    function changeInstrument(path, name) {
      player.loader.startLoad(audioContext, path, name);
      player.loader.waitLoad(function() {
        instr = window[name];
      });
    }
    changeInstrument(
      "https://surikov.github.io/webaudiofontdata/sound/0520_Aspirin_sf2_file.js",
      "_tone_0520_Aspirin_sf2_file"
    );

    this.nextTrack();
  }
};
</script>
